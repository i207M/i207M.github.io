<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"blog.i207m.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Learn from this 2020.7.31 容器初始化 1234list:[]tuple:()dict:&amp;#123;:&amp;#125;set:&amp;#123;&amp;#125; 函数参数 位置参数 默认参数：默认参数必须指向不变对象！默认参数的值是在函数构建时被定义的。可以单独定义某个默认参数的值： 1234def enroll(a, b, c&#x3D;1, d&#x3D;2):    print(a, b, c, d)">
<meta property="og:type" content="article">
<meta property="og:title" content="Python学习笔记">
<meta property="og:url" content="https://blog.i207m.top/2021/02/Python-learning/index.html">
<meta property="og:site_name" content="i207M&#39;s Fantastic Blog">
<meta property="og:description" content="Learn from this 2020.7.31 容器初始化 1234list:[]tuple:()dict:&amp;#123;:&amp;#125;set:&amp;#123;&amp;#125; 函数参数 位置参数 默认参数：默认参数必须指向不变对象！默认参数的值是在函数构建时被定义的。可以单独定义某个默认参数的值： 1234def enroll(a, b, c&#x3D;1, d&#x3D;2):    print(a, b, c, d)">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://i.loli.net/2020/08/04/HPh7R5XcgVzAMpn.png">
<meta property="og:image" content="https://i.loli.net/2020/08/10/24dZyRCYlbG1POB.jpg">
<meta property="og:image" content="https://i.loli.net/2020/08/10/o1c93qCtTzPfi4g.jpg">
<meta property="og:image" content="https://i.loli.net/2020/08/14/EWqJR2jgoLUs7kT.png">
<meta property="article:published_time" content="2021-02-22T02:37:02.000Z">
<meta property="article:modified_time" content="2025-03-05T01:24:34.775Z">
<meta property="article:author" content="i207M">
<meta property="article:tag" content="Python">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://i.loli.net/2020/08/04/HPh7R5XcgVzAMpn.png">

<link rel="canonical" href="https://blog.i207m.top/2021/02/Python-learning/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>


  <title>Python学习笔记 | i207M's Fantastic Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="i207M's Fantastic Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">i207M's Fantastic Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Welcome</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-留言">

    <a href="/messages/" rel="section"><i class="fa fa-fw fa-comments"></i>留言</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://blog.i207m.top/2021/02/Python-learning/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="i207M">
      <meta itemprop="description" content="i207M's Fantastic Blog - Love">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="i207M's Fantastic Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Python学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-22 10:37:02" itemprop="dateCreated datePublished" datetime="2021-02-22T10:37:02+08:00">2021-02-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Dev/" itemprop="url" rel="index"><span itemprop="name">Dev</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Learn from <a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1016959663602400">this</a></p>
<h2 id="2020-7-31" id="2020-7-31">2020.7.31</h2>
<h3 id="rong-qi-chu-shi-hua" id="容器初始化">容器初始化</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">list:[]</span><br><span class="line">tuple:()</span><br><span class="line">dict:&#123;:&#125;</span><br><span class="line">set:&#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="han-shu-can-shu" id="函数参数">函数参数</h3>
<h4 id="wei-zhi-can-shu" id="位置参数">位置参数</h4>
<p>默认参数：默认参数必须指向不变对象！默认参数的值是在函数构建时被定义的。可以单独定义某个默认参数的值：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">enroll</span>(<span class="params">a, b, c=<span class="number">1</span>, d=<span class="number">2</span></span>):</span><br><span class="line">    <span class="built_in">print</span>(a, b, c, d)</span><br><span class="line"></span><br><span class="line">enroll(<span class="number">1</span>, <span class="number">2</span>, d=<span class="number">5</span>) <span class="comment"># output: 1 2 1 5</span></span><br></pre></td></tr></table></figure>
<h4 id="ke-bian-can-shu" id="可变参数">可变参数</h4>
<p>可以传入一个<code>tuple</code>来解决</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">numbers</span>):</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> numbers:</span><br><span class="line">        <span class="built_in">sum</span> = <span class="built_in">sum</span> + n * n</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc((<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)) <span class="comment"># 此处要用双层括号</span></span><br><span class="line"><span class="number">14</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calc</span>(<span class="params">*numbers</span>):</span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> numbers:</span><br><span class="line">        <span class="built_in">sum</span> = <span class="built_in">sum</span> + n * n</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc()</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>nums = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc(*nums)</span><br><span class="line"><span class="number">14</span></span><br></pre></td></tr></table></figure>
<p><code>*</code>的作用是将tuple的内容拆成一个个参数然后传入。</p>
<h4 id="guan-jian-zi-can-shu" id="关键字参数">关键字参数</h4>
<p>可变参数允许你传入0个或任意个参数，这些可变参数在函数调用时自动组装为一个<strong>tuple</strong>。而关键字参数允许你传入0个或任意个含参数名的参数，这些关键字参数在函数内部自动组装为一个<strong>dict</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">person</span>(<span class="params">name, age, **kw</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;name:&#x27;</span>, name, <span class="string">&#x27;age:&#x27;</span>, age, <span class="string">&#x27;other:&#x27;</span>, kw)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Adam&#x27;</span>, <span class="number">45</span>, gender=<span class="string">&#x27;M&#x27;</span>, job=<span class="string">&#x27;Engineer&#x27;</span>)</span><br><span class="line">name: Adam age: <span class="number">45</span> other: &#123;<span class="string">&#x27;gender&#x27;</span>: <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>&#125;</span><br><span class="line">            </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>extra = &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;Beijing&#x27;</span>, <span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Jack&#x27;</span>, <span class="number">24</span>, **extra)</span><br><span class="line">name: Jack age: <span class="number">24</span> other: &#123;<span class="string">&#x27;city&#x27;</span>: <span class="string">&#x27;Beijing&#x27;</span>, <span class="string">&#x27;job&#x27;</span>: <span class="string">&#x27;Engineer&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ming-ming-guan-jian-zi-can-shu" id="命名关键字参数">命名关键字参数</h4>
<p>限制关键字参数的名字。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">person</span>(<span class="params">name, age, *, city, job</span>):</span><br><span class="line">    <span class="built_in">print</span>(name, age, city, job)</span><br><span class="line">    </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>person(<span class="string">&#x27;Jack&#x27;</span>, <span class="number">24</span>, city=<span class="string">&#x27;Beijing&#x27;</span>, job=<span class="string">&#x27;Engineer&#x27;</span>)</span><br><span class="line">Jack <span class="number">24</span> Beijing Engineer</span><br></pre></td></tr></table></figure>
<p>命名关键字参数必须传入参数名；命名关键字参数可以有缺省值。</p>
<p>如果函数定义中已经有了一个可变参数，后面跟着的命名关键字参数就不再需要一个特殊分隔符<code>*</code>了。</p>
<h4 id="can-shu-zu-he" id="参数组合">参数组合</h4>
<p>参数定义的顺序必须是：必选参数、默认参数、可变参数、命名关键字参数和关键字参数。</p>
<p>使用<code>*args</code>和<code>**kw</code>是Python的习惯写法，当然也可以用其他参数名，但最好使用习惯用法。</p>
<h3 id="qie-pian" id="切片">切片</h3>
<p><code>s[L:R:D]</code>表示将s的<code>[L,R)</code>间距为D的片段切下来</p>
<p>特别的，<code>s[:2]</code> 表示切<code>s</code>的前两个元素；<code>s[-2:]</code>表示切<code>s</code>的后两个元素。</p>
<h3 id="die-dai" id="迭代">迭代</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;c&#x27;</span>: <span class="number">3</span>&#125;</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> d:</span><br><span class="line">    <span class="built_in">print</span>(key)</span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> d.values():</span><br><span class="line">    <span class="built_in">print</span>(val)</span><br><span class="line"><span class="keyword">for</span> it <span class="keyword">in</span> d.items():</span><br><span class="line">    <span class="built_in">print</span>(it) <span class="comment"># tuple</span></span><br></pre></td></tr></table></figure>
<p>如果要对list实现类似Java那样的下标循环怎么办？Python内置的<code>enumerate</code>函数可以把一个list变成索引-元素对，这样就可以在<code>for</code>循环中同时迭代索引和元素本身：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, val <span class="keyword">in</span> <span class="built_in">enumerate</span>([<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]):</span><br><span class="line">    <span class="built_in">print</span>(i, val)</span><br><span class="line">    </span><br><span class="line"><span class="number">0</span> A</span><br><span class="line"><span class="number">1</span> B</span><br><span class="line"><span class="number">2</span> C</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x, y <span class="keyword">in</span> [(<span class="number">1</span>, <span class="number">1</span>), (<span class="number">2</span>, <span class="number">4</span>), (<span class="number">3</span>, <span class="number">9</span>)]:</span><br><span class="line">	<span class="built_in">print</span>(x, y)</span><br></pre></td></tr></table></figure>
<h3 id="lie-biao-sheng-cheng-shi" id="列表生成式">列表生成式</h3>
<p>感觉很好用！</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">L = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>))</span><br><span class="line">L = [x * x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>) <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span>]</span><br><span class="line">L = [m + n <span class="keyword">for</span> m <span class="keyword">in</span> [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>] <span class="keyword">for</span> n <span class="keyword">in</span> [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>]]</span><br></pre></td></tr></table></figure>
<h4 id="if-else-for" id="if-else-for">if,else,for</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>[x <span class="keyword">if</span> x % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> -x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">11</span>)]</span><br><span class="line">[-<span class="number">1</span>, <span class="number">2</span>, -<span class="number">3</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">6</span>, -<span class="number">7</span>, <span class="number">8</span>, -<span class="number">9</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<p>在一个列表生成式中，<code>for</code>前面的<code>if ... else</code>是表达式，而<code>for</code>后面的<code>if</code>是过滤条件，不能带<code>else</code>。</p>
<h3 id="sheng-cheng-qi" id="生成器">生成器</h3>
<p>简单的生成器相当于把list换成tuple。生成器只有next方式调出下一个，不能随机访问。可以用for遍历。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">g = (x * x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">next</span>(g))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> g:</span><br><span class="line">    <span class="built_in">print</span>(x, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">1</span> <span class="number">4</span> <span class="number">9</span> <span class="number">16</span> <span class="number">25</span> <span class="number">36</span> <span class="number">49</span> <span class="number">64</span> <span class="number">81</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 斐波那契数列生成器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fib</span>():</span><br><span class="line">    a, b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">yield</span> b <span class="comment"># ！！！</span></span><br><span class="line">        a, b = b, a + b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f = fib()</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> f:</span><br><span class="line">    <span class="built_in">print</span>(x)</span><br><span class="line">    <span class="built_in">input</span>()</span><br></pre></td></tr></table></figure>
<p>变成generator的函数，在每次调用<code>next()</code>的时候执行，遇到<code>yield</code>语句返回，再次执行时从上次返回的<code>yield</code>语句处继续执行。</p>
<p>generator函数也可以有返回值。如果想要拿到返回值，必须捕获<code>StopIteration</code>错误，返回值包含在<code>StopIteration</code>的<code>value</code>中。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">triangles</span>():</span><br><span class="line">    A = []</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A) - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            A[i] += A[i - <span class="number">1</span>]</span><br><span class="line">        A.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">yield</span> <span class="built_in">list</span>(A)</span><br></pre></td></tr></table></figure>
<p>以上是生成杨辉三角的生成器，值得注意的一点是，函数如果直接返回A，那么在函数里A的值改变的话，导出的A的值也会变。</p>
<p>改进版：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">triangles</span>():</span><br><span class="line">    A = [<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">yield</span> A</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        A = [<span class="number">1</span>] + [A[i] + A[i + <span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(A) - <span class="number">1</span>)] + [<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">yield</span> A</span><br></pre></td></tr></table></figure>
<p>为什么这样就可以返回A了呢，因为每经过一次赋值操作，A的地址都会重新分配。</p>
<h2 id="8-1" id="8-1">8.1</h2>
<h3 id="map-amp-reduce" id="map-reduce">map&amp;reduce</h3>
<p>我们先看map。<code>map()</code>函数接收两个参数，一个是函数，一个是<code>Iterable</code>，<code>map</code>将传入的函数依次作用到序列的每个元素，并把结果作为新的<code>Iterator</code>返回。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">	<span class="keyword">return</span> x * x</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r = <span class="built_in">map</span>(f, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">list</span>(r)</span><br><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">16</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br></pre></td></tr></table></figure>
<p><code>reduce</code>把一个函数作用在一个序列<code>[x1, x2, x3, ...]</code>上，这个函数必须接收两个参数，<code>reduce</code>把结果继续和序列的下一个元素做累积计算，其效果就是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4)</span><br></pre></td></tr></table></figure>
<p>比方说对一个序列求和，就可以用<code>reduce</code>实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">x, y</span>):</span><br><span class="line">	<span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>reduce(add, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>])</span><br><span class="line"><span class="number">25</span></span><br></pre></td></tr></table></figure>
<p>利用此方法可以方便的实现str转int：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">str2int</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">fn</span>(<span class="params">x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> x * <span class="number">10</span> + y</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">char2num</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> DIGITS[s]</span><br><span class="line">    <span class="keyword">return</span> reduce(fn, <span class="built_in">map</span>(char2num, s))</span><br><span class="line"></span><br><span class="line"><span class="comment"># lambda</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">char2num</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> DIGITS[s]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2int</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x, y: x * <span class="number">10</span> + y, <span class="built_in">map</span>(char2num, s))</span><br><span class="line"></span><br><span class="line"><span class="comment"># str2float</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">str2float</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">x, y</span>):</span><br><span class="line">        <span class="keyword">return</span> x * <span class="number">10</span> + y</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">str2num</span>(<span class="params">s</span>):</span><br><span class="line">        <span class="keyword">return</span> reduce(merge, <span class="built_in">map</span>(<span class="built_in">int</span>, s))</span><br><span class="line"></span><br><span class="line">    p = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> p &lt; <span class="built_in">len</span>(s) <span class="keyword">and</span> s[p] != <span class="string">&#x27;.&#x27;</span>:</span><br><span class="line">        p += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> p == <span class="built_in">len</span>(s):</span><br><span class="line">        <span class="keyword">return</span> str2num(s)</span><br><span class="line">    <span class="keyword">return</span> str2num(s[:p]) + str2num(s[p + <span class="number">1</span>:]) * <span class="number">0.1</span>**(<span class="built_in">len</span>(s) - p - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 写的还是太长，等学会lambda和str的函数再简化吧</span></span><br></pre></td></tr></table></figure>
<h3 id="filter" id="filter">filter</h3>
<p>接收一个函数和一个序列，返回一个Iterator，只保留True的元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_palindrome</span>(<span class="params">n</span>):</span><br><span class="line">    s = <span class="built_in">str</span>(n)</span><br><span class="line">    <span class="keyword">return</span> s == s[::-<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>筛回文好简单…</p>
<h3 id="sorted" id="sorted">sorted</h3>
<p>我们给<code>sorted</code>传入key函数，即可实现忽略大小写的排序，相当于把所有元素都应用key之后再排序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>([<span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;about&#x27;</span>, <span class="string">&#x27;Zoo&#x27;</span>, <span class="string">&#x27;Credit&#x27;</span>], key=<span class="built_in">str</span>.lower)</span><br><span class="line">[<span class="string">&#x27;about&#x27;</span>, <span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;Credit&#x27;</span>, <span class="string">&#x27;Zoo&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>要进行反向排序，不必改动key函数，可以传入第三个参数<code>reverse=True</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>([<span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;about&#x27;</span>, <span class="string">&#x27;Zoo&#x27;</span>, <span class="string">&#x27;Credit&#x27;</span>], key=<span class="built_in">str</span>.lower, reverse=<span class="literal">True</span>)</span><br><span class="line">[<span class="string">&#x27;Zoo&#x27;</span>, <span class="string">&#x27;Credit&#x27;</span>, <span class="string">&#x27;bob&#x27;</span>, <span class="string">&#x27;about&#x27;</span>]</span><br></pre></td></tr></table></figure>
<h3 id="bi-bao" id="闭包">闭包</h3>
<p>大杀器。类似于C++中的lamba.</p>
<p>返回一个函数，这个函数会同时包含它所需要的变量。</p>
<p>需要注意的问题：</p>
<p>返回的函数没有立即执行，而是等到调用才执行。 <strong>返回闭包时牢记一点：返回函数不要引用任何循环变量，或者后续会发生变化的变量。</strong></p>
<p>如果一定要引用循环变量怎么办？方法是再创建一个函数，用该函数的参数绑定循环变量当前的值，无论该循环变量后续如何更改，已绑定到函数参数的值不变：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">count</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">j</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">g</span>():</span><br><span class="line">            <span class="keyword">return</span> j*j</span><br><span class="line">        <span class="keyword">return</span> g</span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        fs.append(f(i)) <span class="comment"># f(i)立刻被执行，因此i的当前值被传入f()</span></span><br><span class="line">    <span class="keyword">return</span> fs</span><br></pre></td></tr></table></figure>
<h4 id="chuang-jian-ji-shu-qi" id="创建计数器">创建计数器</h4>
<p>这道题很妙啊。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">createCounter</span>():</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">counter</span>():</span><br><span class="line">        <span class="keyword">nonlocal</span> n <span class="comment"># 声明这是外层的变量</span></span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> counter</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">createCounter</span>():</span><br><span class="line">    n = [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">counter</span>():</span><br><span class="line">        n[<span class="number">0</span>] += <span class="number">1</span> <span class="comment"># 为什么这里可以修改？因为n这个变量实际上是指向一片内存地址！</span></span><br><span class="line">        <span class="keyword">return</span> n[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> counter</span><br></pre></td></tr></table></figure>
<h3 id="global-amp-nonlocal" id="global-nonlocal">global&amp;nonlocal</h3>
<p>global用于修改全局变量；</p>
<p>nonlocal用于在函数或其他作用域中使用外层(非全局)变量。</p>
<h3 id="ni-ming-han-shu" id="匿名函数">匿名函数</h3>
<p>关键字<code>lambda</code>表示匿名函数，冒号前面的<code>x</code>表示函数参数，冒号后面的表达式是返回值。</p>
<h3 id="zhuang-shi-qi" id="装饰器">装饰器</h3>
<p>函数对象有一个<code>__name__</code>属性，可以拿到函数的名字：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f=now</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>now.__name__</span><br><span class="line"><span class="string">&#x27;now&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.__name__</span><br><span class="line"><span class="string">&#x27;now&#x27;</span></span><br></pre></td></tr></table></figure>
<p>假设我们要在<code>now</code>函数调用前后自动打印日志，但又不希望修改<code>now()</code>函数的定义，这种在代码运行期间动态增加功能的方式，称之为“装饰器”。</p>
<p>本质上，decorator就是一个返回函数的高阶函数，可以定义如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kw</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;call %s():&#x27;</span> % func.__name__)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
<p>我们可以借助Python的@语法，把decorator置于函数的定义处：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">now</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>调用<code>now()</code>函数，不仅会运行<code>now()</code>函数本身，还会在运行<code>now()</code>函数前打印一行日志。</p>
<p>把<code>@log</code>放到<code>now()</code>函数的定义处，相当于执行了语句：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">now = log(now)</span><br></pre></td></tr></table></figure>
<p><code>wrapper()</code>函数的参数定义是<code>(*args, **kw)</code>，因此，<code>wrapper()</code>函数可以接受任意参数的调用。</p>
<p>decorater本身也可以传入参数：</p>
<p>比如，要自定义log的文本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">decorator</span>(<span class="params">func</span>):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kw</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;%s %s():&#x27;</span> % (text, func.__name__))</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> decorator</span><br></pre></td></tr></table></figure>
<p>这个3层嵌套的decorator用法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@log(<span class="params"><span class="string">&#x27;execute&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">now</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>但是，这样装饰之后的 函数，它的<code>__name__</code>已经不是原来的函数了。Python内置的<code>functools.wraps</code>就是干这个事的，所以，一个完整的decorator的写法如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">log</span>(<span class="params">func</span>):</span><br><span class="line"><span class="meta">    @functools.wraps(<span class="params">func</span>) </span><span class="comment"># !!!</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kw</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;call %s():&#x27;</span> % func.__name__)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kw)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
<p>请设计一个decorator，它可作用于任何函数上，并打印该函数的执行时间：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">metric</span>(<span class="params">fn</span>):</span><br><span class="line"><span class="meta">    @functools.wraps(<span class="params">fn</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">warpper</span>(<span class="params">*args, **kw</span>):</span><br><span class="line">        s = time.time()</span><br><span class="line">        r = fn(*args, **kw)</span><br><span class="line">        e = time.time()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s run in %.2f ms&#x27;</span> % (fn.__name__, e - s))</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> warpper</span><br></pre></td></tr></table></figure>
<p>使用decorator，还可以实现诸如：当遇到错误重试最多5次该函数，再结束。</p>
<h3 id="pian-han-shu" id="偏函数">偏函数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int2 = functools.partial(<span class="built_in">int</span>, base=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>固定函数的参数。</p>
<h2 id="8-2" id="8-2">8.2</h2>
<h3 id="mo-kuai" id="模块">模块</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;A module&#x27;</span>  <span class="comment"># 任何模块代码的第一个字符串都被视为模块的文档注释，可以用__doc__调用</span></span><br><span class="line"></span><br><span class="line">__author__ = <span class="string">&#x27;i207M&#x27;</span> <span class="comment"># 标准模板</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run</span>():</span><br><span class="line">    <span class="built_in">print</span>(sys.argv) <span class="comment"># sys模块定义了sys.argv，本质是list，储存了调用这个py文件的参数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>: <span class="comment"># 当且仅当它是独立运行而不是被import进别的py时，此判断为True</span></span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>
<p>运行<code>python3 hello.py</code>获得的<code>sys.argv</code>就是<code>['hello.py']</code>；</p>
<p>运行<code>python3 hello.py Michael</code>获得的<code>sys.argv</code>就是<code>['hello.py', 'Michael']</code>。</p>
<h4 id="zuo-yong-yu" id="作用域">作用域</h4>
<p>正常函数的命名是公开的。</p>
<p>类似<code>__xxx__</code>这样的变量是特殊变量，可以被直接引用，但是有特殊用途，如<code>__author__</code>，<code>__name__</code>，<code>__doc__</code>。</p>
<p>类似<code>_xxx</code>和<code>__xxx</code>这样的函数或变量就是非公开的，不应该被直接引用。不应该，不是不能。</p>
<h3 id="mian-xiang-dui-xiang-oop" id="面向对象OOP">面向对象OOP</h3>
<p><code>__init__</code>方法相当于构造函数。注意到<code>__init__</code>方法的第一个参数永远是<code>self</code>，表示创建的实例本身。</p>
<p>如果要让内部属性不被外部访问，可以把属性的名称前加上两个下划线<code>__</code>，这样在外部就真的无法访问。但是在外部定义class的<code>__</code>开头的变量是可以被访问的。</p>
<p>在Python中，变量名类似<code>__xxx__</code>的，也就是以双下划线开头，并且以双下划线结尾的，是特殊变量，特殊变量是可以直接访问的，不是private变量，所以，不能用<code>__name__</code>、<code>__score__</code>这样的变量名。</p>
<p>有些时候，你会看到以一个下划线开头的实例变量名，比如<code>_name</code>，这样的实例变量外部是可以访问的，但是，按照约定俗成的规定，当你看到这样的变量时，意思就是，“虽然我可以被访问，但是，请把我视为私有变量，不要随意访问”。</p>
<p>这就是著名的**开闭原则 **：</p>
<p>对扩展开放：允许新增<code>Animal</code>子类；</p>
<p>对修改封闭：不需要修改依赖<code>Animal</code>类型的<code>run_twice()</code>等函数。</p>
<p><em>“鸭子类型”：它并不要求严格的继承体系，一个对象只要“看起来像鸭子，走起路来像鸭子”，那它就可以被看做是鸭子。</em></p>
<p><code>print</code>一个class，实质会调用<code>__str__()</code>函数，打印此函数的返回值。直接在控制台输入变量，打印的实例是调用<code>__repr__()</code>。</p>
<h4 id="ding-zhi-lei" id="定制类">定制类</h4>
<p>定义了<code>__iter__(),__next__()</code>，就可以被用于<code>for ... in </code>循环：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Fib</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self._a, self._b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__iter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__next__</span>(<span class="params">self</span>):</span><br><span class="line">        self._a, self._b = self._b, self._a + self._b</span><br><span class="line">        <span class="keyword">if</span> self._a &gt; <span class="number">1000</span>:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration()</span><br><span class="line">        <span class="keyword">return</span> self._a</span><br></pre></td></tr></table></figure>
<p>实现<code>__getitem__()</code>方法，可以按下标访问任意一项。</p>
<p>当调用不存在的属性时，Python解释器会试图调用<code>__getattr__(self, 'name')</code>来尝试获得属性。</p>
<p>利用完全动态的<code>__getattr__</code>，我们可以写出一个链式调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Chain</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, path=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">        self._path = path</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getattr__</span>(<span class="params">self, path</span>):</span><br><span class="line">        <span class="keyword">return</span> Chain(<span class="string">&#x27;%s/%s&#x27;</span> % (self._path, path))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self._path</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__</span><br></pre></td></tr></table></figure>
<p>试试：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>Chain().status.user.timeline.<span class="built_in">list</span></span><br><span class="line"><span class="string">&#x27;/status/user/timeline/list&#x27;</span></span><br></pre></td></tr></table></figure>
<p>Niubi</p>
<p>任何类，只需要定义一个<code>__call__()</code>方法，就可以直接对实例进行调用。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Chain</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, path=<span class="string">&#x27;&#x27;</span></span>):</span><br><span class="line">        self.path = path</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__getattr__</span>(<span class="params">self, attr</span>):</span><br><span class="line">        <span class="keyword">return</span> Chain(<span class="string">&quot;%s/%s&quot;</span> % (self.path, attr))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, *args</span>):</span><br><span class="line">        _self = self</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> args:</span><br><span class="line">            _self = Chain(<span class="string">&quot;%s/%s&quot;</span> % (_self.path, i))</span><br><span class="line">        <span class="keyword">return</span> _self</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.path</span><br><span class="line"></span><br><span class="line">    __repr__ = __str__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(Chain().a(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;good&quot;</span>).b)</span><br><span class="line">/a/hello/good/b</span><br></pre></td></tr></table></figure>
<h4 id="type" id="type">type</h4>
<p>type返回类型，是严格的类型，同一个父类下的子类互不相同。</p>
<p>使用<code>instance()</code>函数可以判断继承类型。</p>
<h3 id="lei-he-shi-li" id="类和实例">类和实例</h3>
<p>可以定义类属性和实例属性，实例属性优先于类属性。</p>
<p>配合<code>getattr()</code>、<code>setattr()</code>以及<code>hasattr()</code>，我们可以直接操作一个对象的状态。</p>
<p>为了统计学生人数，可以给Student类增加一个类属性，每创建一个实例，该属性自动增加：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name</span>):</span><br><span class="line">        self.name = name</span><br><span class="line">        Student.count += <span class="number">1</span> <span class="comment"># 方便！</span></span><br></pre></td></tr></table></figure>
<p>我们可以给类一个方法，只需要在定义时加上<code>@classmethod</code>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">bark</span>(<span class="params">cls</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;WO-&#x27;</span>)</span><br><span class="line"><span class="comment"># 调用</span></span><br><span class="line">Dog.bark()</span><br></pre></td></tr></table></figure>
<h4 id="qi-ta-fang-fa" id="其他方法">其他方法</h4>
<p><code>__doc__()</code></p>
<p><code>__str__()</code></p>
<p><code>__repr__()</code></p>
<p><code>__lt__()</code>（小于运算符）</p>
<p><code>__getitem__()</code>（使用<code>obj[key]</code>）</p>
<p><code>__setitem__()</code></p>
<p><code>__len__()</code></p>
<p><code>__del__()</code></p>
<h4 id="gei-shi-li-bang-ding-yi-ge-fang-fa" id="给实例绑定一个方法">给实例绑定一个方法</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">set_age</span>(<span class="params">self, age</span>): <span class="comment"># 定义一个函数作为实例方法</span></span><br><span class="line"><span class="meta">... </span>    self.age = age</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> types <span class="keyword">import</span> MethodType</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.set_age = MethodType(set_age, s) <span class="comment"># 给实例绑定一个方法，只有s能调用</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">set_score</span>(<span class="params">self, score</span>):</span><br><span class="line"><span class="meta">... </span>    self.score = score</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Student.set_score = set_score <span class="comment"># 所有实例都可以调用</span></span><br></pre></td></tr></table></figure>
<p>Python允许在定义class的时候，定义一个特殊的<code>__slots__</code>变量，来限制该class实例能添加的属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    __slots__ = (<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>) <span class="comment"># 用tuple定义允许绑定的属性名称</span></span><br></pre></td></tr></table></figure>
<p>对子类不起作用，除非在子类中也定义<code>__slots__</code>，这样，子类实例允许定义的属性就是自身的<code>__slots__</code>加上父类的<code>__slots__</code>。</p>
<p>但是当父类无<code>__slots__</code>，而子类有，则无效。</p>
<h3 id="property" id="property">@property</h3>
<p>实现类的时候，我们常常需要提供各种借口，但是为每个接口都写一个函数有些麻烦，使用也不方便，我们可以用<code>@property</code>，使得可以直接调用变量，用等号修改，且进行范围检查。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">score</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> self.__score</span><br><span class="line"></span><br><span class="line"><span class="meta">    @score.setter</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">score</span>(<span class="params">self, val</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> &lt;= val <span class="keyword">and</span> val &lt;= <span class="number">100</span>:</span><br><span class="line">            self.__score = val</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;Score Error&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><code>@property</code>后定义的函数作为此名变量的getter方法；此时，<code>@property</code>本身又创造了另一个修饰器<code>@score.setter</code>，实现setter方法，如果没有setter方法，则变量为只读。</p>
<h3 id="duo-zhong-ji-cheng" id="多重继承">多重继承</h3>
<p>RT：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>(Mammal, Runnable):</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>如果方法重复怎么办？优先保留顺序靠前的。</p>
<p>需要注意，如果子类定义了<code>__init__()</code>函数，那么初始化时不会调用父类的<code>__init__()</code>，因此需要显式地调用它。</p>
<h3 id="mei-ju-lei" id="枚举类">枚举类</h3>
<p>继承自Enum。<code>@unique</code>装饰器可以帮助我们检查保证没有重复值。</p>
<h3 id="yuan-lei" id="元类">元类</h3>
<p><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017592449371072">太 妙 了！豁然开朗！</a>（用到时再复习吧）</p>
<p><strong><a target="_blank" rel="noopener" href="https://mozillazg.com/2016/12/python-super-is-not-as-simple-as-you-thought.html">super()</a></strong></p>
<h2 id="8-3" id="8-3">8.3</h2>
<h3 id="cuo-wu-chu-li" id="错误处理">错误处理</h3>
<p>感觉这个挺重要的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">expect ... <span class="keyword">as</span> ...:</span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>出错时，直接跳转到except语句块。错误也是class，继承自<code>BaseException</code>。</p>
<p>如果错误没有被捕获，会一直往上抛，最后被Python解释器捕获，打印错误信息并退出。这就是<strong>调用栈</strong>。</p>
<p>Python内置的<code>logging</code>模块可以记录错误信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    main()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    logging.exception(e)</span><br></pre></td></tr></table></figure>
<p>这样程序可以继续运行，并且错误被记录。</p>
<p><code>except</code>语句内可以继续<code>raise</code>，抛给上一层。</p>
<p><strong>finally</strong>: 无论有没有异常，都会执行。优先级极高，甚至在<code>try</code>内<code>return</code>，则也会执行<code>finally</code>.</p>
<h3 id="diao-shi" id="调试">调试</h3>
<p><code>assert</code>+VS Code</p>
<h3 id="wen-jian-du-xie" id="文件读写">文件读写</h3>
<p>使用<code>f=open(file,'r'/'rb'/'w'/'a'[,encoding=])</code>，退出程序前记得<code>f.close()</code>。</p>
<p>方便的方法是使用<code>with</code>语句：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/Users/michael/test.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;Hello, world!&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>建议使用<code>with</code>语句，以防忘记<code>close</code>，如果不能直接使用<code>with</code>语句，可以</p>
<h4 id="string-io-amp-bytes-io" id="StringIO-BytesIO">StringIO&amp;BytesIO</h4>
<p>在内存中读写str。像文件一样写入即可。<code>from io import StringIO</code></p>
<h4 id="os-mo-kuai" id="os模块">os模块</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">os.path.abspath(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">os.path.join(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>) <span class="comment"># 拼接路径</span></span><br><span class="line">os.mkdir(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">os.rmdir(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">os.path.split(<span class="string">&#x27;&#x27;</span>) <span class="comment"># 返回list，将路径拆为两部分，后一部分是文件（夹）名</span></span><br><span class="line">os.path.splittext(<span class="string">&#x27;&#x27;</span>) <span class="comment"># 返回文件扩展名</span></span><br><span class="line">os.rename(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">os.remove(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">os.listdir(<span class="string">&#x27;&#x27;</span>) <span class="comment"># 文件夹+文件</span></span><br><span class="line">os.path.isdir(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><code>copyfile()</code>在<code>shutil</code>模块。</p>
<p><code>os.walk('') </code>返回的是一个三元组(root,dirs,files)。</p>
<ul>
<li>root 所指的是当前正在遍历的这个文件夹的本身的地址</li>
<li>dirs 是一个 list ，内容是该文件夹中所有的目录的名字(不包括子目录)</li>
<li>files 同样是 list , 内容是该文件夹中所有的文件(不包括子目录)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> root, dirs, files <span class="keyword">in</span> os.walk(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> files:</span><br><span class="line">        <span class="built_in">print</span>(os.path.join(root, name))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mywalk</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">for</span> name <span class="keyword">in</span> os.listdir(path):</span><br><span class="line">        ful = os.path.join(path, name)</span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(name):</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                mywalk(ful)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(e)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(ful)</span><br></pre></td></tr></table></figure>
<p>面向对象式的<code>os</code>替代品：<code>Pathlib</code>，教程见<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzUyOTk2MTcwNg==&amp;mid=2247491952&amp;idx=1&amp;sn=f27a546699f26dc21a78b8af20b5d799&amp;chksm=fa5ba6f5cd2c2fe3cfaefdf52e848481ed9761acbbd86469fd7016fc761d820e88d10f733dae">这里</a></p>
<h3 id="xu-lie-hua" id="序列化">序列化</h3>
<p>先鸽了。大致用途是将Python对象变成JSON。</p>
<h3 id="chang-yong-nei-jian-mo-kuai" id="常用内建模块">常用内建模块</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">now = datetime.now() <span class="comment"># 是一个class</span></span><br><span class="line">t = now.timestamp() <span class="comment"># 返回从1970年开始的秒数，浮点数</span></span><br><span class="line">datetime.fromtimestamp(t) <span class="comment"># 本地时区</span></span><br><span class="line"></span><br><span class="line">day = datetime.strptime(<span class="string">&#x27;2015-6-1 18:19:59&#x27;</span>, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>) <span class="comment"># 注意，转换后无时区信息</span></span><br><span class="line"><span class="built_in">print</span>(now.strftime(<span class="string">&#x27;%a, %b %d %H:%M&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_timestamp</span>(<span class="params">dt_str, tz_str</span>):</span><br><span class="line">    tim = datetime.strptime(dt_str, <span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>)</span><br><span class="line">    sq = re.findall(<span class="string">r&#x27;UTC(.*):00&#x27;</span>, tz_str)</span><br><span class="line">    sq = <span class="built_in">int</span>(sq[<span class="number">0</span>])</span><br><span class="line">    tim = tim.replace(tzinfo=timezone(timedelta(hours=sq)))</span><br><span class="line">    <span class="keyword">return</span> tim.timestamp()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t1 = to_timestamp(<span class="string">&#x27;2015-6-1 08:10:30&#x27;</span>, <span class="string">&#x27;UTC+7:00&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> t1 == <span class="number">1433121030.0</span></span><br></pre></td></tr></table></figure>
<p>如果要存储<code>datetime</code>，最佳方法是将其转换为timestamp再存储，因为timestamp的值与时区完全无关。</p>
<h4 id="collections" id="collections">collections</h4>
<p><code>namedtuple('NAME',['args'])</code></p>
<p><code>deque</code></p>
<p><code>defaultdict(function)</code>有默认值的<code>dict</code></p>
<h4 id="hashlib" id="hashlib">hashlib</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">md5 = hashlib.md5(<span class="string">&#x27;original&#x27;</span>)</span><br><span class="line">md5.update(<span class="string">&#x27;Hello, &#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>)) <span class="comment"># 必须encode</span></span><br><span class="line">md5.update(<span class="string">&#x27;World&#x27;</span>.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(md5.hexdigest())</span><br><span class="line"><span class="comment"># 同理可用sha1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hmac</span><br><span class="line">h=hmac.new(key, message, digestmode=<span class="string">&#x27;MD5&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="itertools" id="itertools">itertools</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> c <span class="keyword">in</span> itertools.chain(<span class="string">&#x27;ABC&#x27;</span>, <span class="string">&#x27;XYZ&#x27;</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="built_in">print</span>(c)</span><br><span class="line"><span class="comment"># 迭代效果：&#x27;A&#x27; &#x27;B&#x27; &#x27;C&#x27; &#x27;X&#x27; &#x27;Y&#x27; &#x27;Z&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="8-4" id="8-4">8.4</h2>
<p>昨天属实有点摸鱼。今天把<code>urllib</code>这些事学了。</p>
<p>强基快要出结果了.jpg</p>
<p>学这个之前要先把JSON学了。</p>
<h3 id="json" id="JSON">JSON</h3>
<p><img data-src="https://i.loli.net/2020/08/04/HPh7R5XcgVzAMpn.png" alt="image-20200804083520132"></p>
<p>使用内置的<code>json</code>模块。</p>
<p><code>json.dumps(arg)</code>返回<code>str</code>，内容是标准的JSON。<code>dump(arg,file)</code>可以直接把结果写入文件流中。</p>
<p>反序列化使用<code>loads()/load()</code>。</p>
<p>如果是自定义的Class如何序列化？</p>
<p>可选参数<code>default</code>把任意一个对象变成一个可序列为JSON的对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">student2dict</span>(<span class="params">std</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">dict</span>(</span><br><span class="line">        name=std.name,</span><br><span class="line">        age=std.age,</span><br><span class="line">        score=std.score,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>
<p>有一个Trick方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">json.dumps(t, default=<span class="keyword">lambda</span> obj: obj.__dict__)</span><br></pre></td></tr></table></figure>
<p>同理可以反序列化。</p>
<h3 id="urllib" id="urllib">urllib</h3>
<p>基本上实现GET和POST就够了。</p>
<h4 id="get" id="GET">GET</h4>
<p><code>request</code>模块可以发送一个GET到指定的页面。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> request.urlopen(<span class="string">&#x27;https://yesno.wtf/api&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.read()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Status:&#x27;</span>, f.status, f.reason)</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> f.getheaders():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s: %s&#x27;</span> % (k, v))</span><br><span class="line">    data = data.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Data:&#x27;</span>, data)</span><br><span class="line">    js = json.loads(data)</span><br><span class="line">    <span class="built_in">print</span>(js)</span><br><span class="line">    <span class="keyword">for</span> it <span class="keyword">in</span> js.items():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s: %s&#x27;</span> % it)</span><br></pre></td></tr></table></figure>
<p>挺简单易懂的。如果使用<code>f.getheader(str)</code>，可以返回某个header.</p>
<p><code>urlopen</code>函数除了直接传入网址，还可以传入<code>Request</code>类，实现自定义header，从而自定义UA等功能。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">req = request.Request(<span class="string">&#x27;http://www.douban.com/&#x27;</span>)</span><br><span class="line">req.add_header(<span class="string">&#x27;User-Agent&#x27;</span>, <span class="string">&#x27;Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="post" id="POST">POST</h4>
<p>只需要把参数以bytes形式传入。可以借助<code>parse.urlencode</code>.</p>
<p>模拟微博登录：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, parse</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Login Weibo...&#x27;</span>)</span><br><span class="line">email = <span class="built_in">input</span>(<span class="string">&#x27;Email:&#x27;</span>)</span><br><span class="line">pwd = <span class="built_in">input</span>(<span class="string">&#x27;Password:&#x27;</span>)</span><br><span class="line">login_data = parse.urlencode(</span><br><span class="line">    [</span><br><span class="line">        (<span class="string">&#x27;username&#x27;</span>, email), (<span class="string">&#x27;password&#x27;</span>, pwd), (<span class="string">&#x27;entry&#x27;</span>, <span class="string">&#x27;mweibo&#x27;</span>), (<span class="string">&#x27;client_id&#x27;</span>, <span class="string">&#x27;&#x27;</span>), (<span class="string">&#x27;savestate&#x27;</span>, <span class="string">&#x27;1&#x27;</span>), (<span class="string">&#x27;ec&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">        (<span class="string">&#x27;pagerefer&#x27;</span>, <span class="string">&#x27;https://passport.weibo.cn/signin/welcome?entry=mweibo&amp;r=http%3A%2F%2Fm.weibo.cn%2F&#x27;</span>)</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">req = request.Request(<span class="string">&#x27;https://passport.weibo.cn/sso/login&#x27;</span>)</span><br><span class="line">req.add_header(<span class="string">&#x27;Origin&#x27;</span>, <span class="string">&#x27;https://passport.weibo.cn&#x27;</span>)</span><br><span class="line">req.add_header(<span class="string">&#x27;User-Agent&#x27;</span>, <span class="string">&#x27;Mozilla/6.0 (iPhone; CPU iPhone OS 8_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/8.0 Mobile/10A5376e Safari/8536.25&#x27;</span>)</span><br><span class="line">req.add_header(<span class="string">&#x27;Referer&#x27;</span>, <span class="string">&#x27;https://passport.weibo.cn/signin/login?entry=mweibo&amp;res=wel&amp;wm=3349&amp;r=http%3A%2F%2Fm.weibo.cn%2F&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> request.urlopen(req, data=login_data.encode(<span class="string">&#x27;utf-8&#x27;</span>)) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Status:&#x27;</span>, f.status, f.reason)</span><br><span class="line">    <span class="keyword">for</span> it <span class="keyword">in</span> f.getheaders():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;%s: %s&#x27;</span> % it)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Data:&#x27;</span>, f.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<h4 id="handler" id="Handler">Handler</h4>
<p>默认使用的代理是系统设置的，如果要更改，感觉urllib提供的实现很复杂，之后学习requsets或urllib2.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># urllib</span></span><br><span class="line">proxy_handler = request.ProxyHandler(&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:2334&#x27;</span>, <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;https://127.0.0.1:2334&#x27;</span>&#125;)</span><br><span class="line">proxy_auth_handler = request.ProxyBasicAuthHandler()</span><br><span class="line">opener = request.build_opener(proxy_handler, proxy_auth_handler)</span><br><span class="line"><span class="keyword">with</span> opener.<span class="built_in">open</span>(<span class="string">&#x27;https://www.google.com/&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Status:&#x27;</span>, f.status, f.reason) <span class="comment"># 200 OK</span></span><br></pre></td></tr></table></figure>
<h2 id="8-10" id="8-10">8.10</h2>
<p><code>HTMLParser</code>：先鸽了。</p>
<h3 id="pil" id="PIL">PIL</h3>
<p>Python Imaging Library</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">im = Image.<span class="built_in">open</span>(<span class="string">&#x27;t.png&#x27;</span>)</span><br><span class="line">w, h = im.size</span><br><span class="line">im.thumbnail((w // <span class="number">4</span>, h // <span class="number">4</span>)) <span class="comment"># 缩放</span></span><br><span class="line">im.save(<span class="string">&#x27;tt.jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>)</span><br><span class="line"></span><br><span class="line">im2 = im.<span class="built_in">filter</span>(ImageFilter.BLUR) <span class="comment"># 模糊</span></span><br></pre></td></tr></table></figure>
<h4 id="sheng-cheng-yan-zheng-ma" id="生成验证码">生成验证码</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont, ImageFilter</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rndChar</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(random.randint(<span class="number">65</span>, <span class="number">90</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rndColor</span>():</span><br><span class="line">    <span class="keyword">return</span> (random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rndColor2</span>():</span><br><span class="line">    <span class="keyword">return</span> (random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = <span class="number">60</span></span><br><span class="line">w = h * <span class="number">4</span></span><br><span class="line"></span><br><span class="line">im = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (w, h), (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>)) <span class="comment"># 创建。Modes除了RGB还有&#x27;1&#x27;(1-bit,black and white),&#x27;L&#x27;(8-bit,black and white)</span></span><br><span class="line"></span><br><span class="line">font = ImageFont.truetype(<span class="string">&#x27;arial.ttf&#x27;</span>, <span class="number">36</span>) <span class="comment"># 字体</span></span><br><span class="line">draw = ImageDraw.Draw(im)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">        draw.point((x, y), fill=rndColor()) <span class="comment"># 画背景</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    draw.text((<span class="number">60</span> * t + <span class="number">10</span>, random.randint(<span class="number">1</span>, <span class="number">27</span>)), rndChar(), font=font, fill=rndColor2()) <span class="comment"># 写字母</span></span><br><span class="line"></span><br><span class="line">im = im.<span class="built_in">filter</span>(ImageFilter.BLUR)</span><br><span class="line">im.save(<span class="string">&#x27;code.jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img data-src="https://i.loli.net/2020/08/10/24dZyRCYlbG1POB.jpg" alt=""></p>
<p>加强过后（加入了字符旋转）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont, ImageFilter</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rndChar</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(random.randint(<span class="number">65</span>, <span class="number">90</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rndColor</span>():</span><br><span class="line">    <span class="keyword">return</span> (random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>), random.randint(<span class="number">64</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rndColor2</span>():</span><br><span class="line">    <span class="keyword">return</span> (random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>), random.randint(<span class="number">32</span>, <span class="number">127</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = <span class="number">60</span></span><br><span class="line">w = h * <span class="number">4</span></span><br><span class="line"></span><br><span class="line">im = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (w, h), (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">font = ImageFont.truetype(<span class="string">&#x27;arial.ttf&#x27;</span>, <span class="number">40</span>)</span><br><span class="line">dr = ImageDraw.Draw(im)</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">        dr.point((x, y), fill=rndColor())</span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    text_layer = Image.new(<span class="string">&#x27;RGBA&#x27;</span>, (<span class="number">40</span>, <span class="number">40</span>)) <span class="comment"># 注意是RGBA，A表示透明度</span></span><br><span class="line">    text_draw = ImageDraw.Draw(text_layer)</span><br><span class="line">    text_draw.text((<span class="number">0</span>, <span class="number">0</span>), rndChar(), font=font, fill=(*rndColor2(), <span class="number">255</span>))</span><br><span class="line">    text_layer = text_layer.rotate(random.randint(<span class="number">0</span>, <span class="number">360</span>)) <span class="comment"># 旋转</span></span><br><span class="line">    im.paste(text_layer, (<span class="number">60</span> * t, random.randint(<span class="number">0</span>, <span class="number">20</span>)), text_layer) <span class="comment"># 粘贴</span></span><br><span class="line"></span><br><span class="line">im = im.<span class="built_in">filter</span>(ImageFilter.BLUR)</span><br><span class="line">im.save(<span class="string">&#x27;code.jpg&#x27;</span>, <span class="string">&#x27;jpeg&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img data-src="https://i.loli.net/2020/08/10/o1c93qCtTzPfi4g.jpg" alt=""></p>
<p>爽！PythonNB！</p>
<h3 id="requests" id="requests">requests</h3>
<p>比urllib更强悍。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">r = requests.get(<span class="string">&#x27;URL&#x27;</span>)</span><br><span class="line">r.status_code</span><br><span class="line">r.text <span class="comment"># 内容（自动检测编码）</span></span><br><span class="line">r.content <span class="comment"># bytes对象</span></span><br></pre></td></tr></table></figure>
<p>对于带参数的URL，传入dict作为<code>params</code>参数。</p>
<p><code>headers</code>参数可以传入dict。</p>
<p><em>另外一提，使用http访问百度搜索不需要UA，使用https就必须UA。</em></p>
<p>要发送POST，只需要把方法变成<code>post()</code>，然后用<code>data</code>参数作为POST请求的数据。默认使用<code>application/x-www-form-urlencoded</code>对POST数据编码。如果要传递JSON，可以传入json参数。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xiao__jia__jia/article/details/79357274">四种常见的 POST 提交数据方式</a></p>
<p><em>重写百度翻译爬虫ing</em></p>
<p>上传文件可以使用<code>files</code>参数，读取文件时，必须使用<code>'rb'</code>模式，这样获取的<code>bytes</code>长度才是文件的长度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">upfile = &#123;<span class="string">&#x27;file&#x27;</span>: <span class="built_in">open</span>(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)&#125;</span><br><span class="line">r = requests.post(url, files=upfile)</span><br></pre></td></tr></table></figure>
<p>requests对cookie做了处理，使我们不必解析cookie就可以直接获取指定的cookie。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(r.cookies[<span class="string">&#x27;token&#x27;</span>])</span><br></pre></td></tr></table></figure>
<p>要传入cookie，只需将dict传入<code>cookies</code>参数。</p>
<p>要指定超时，传入以秒为单位的<code>timeout</code>参数。</p>
<h3 id="chardet" id="chardet">chardet</h3>
<p>对于未知编码的<code>bytes</code>，转换成<code>str</code>需要“猜测”编码，<code>chardet</code>这个第三方库通过收集编码的特征字符，有很大概率猜对。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>data = <span class="string">&#x27;离离原上草，一岁一枯荣&#x27;</span>.encode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>chardet.detect(data)</span><br><span class="line">&#123;<span class="string">&#x27;encoding&#x27;</span>: <span class="string">&#x27;GB2312&#x27;</span>, <span class="string">&#x27;confidence&#x27;</span>: <span class="number">0.7407407407407407</span>, <span class="string">&#x27;language&#x27;</span>: <span class="string">&#x27;Chinese&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p><code>confidence</code>是概率。</p>
<h3 id="psutil" id="psutil">psutil</h3>
<p>psutil = process and system utilities</p>
<p>获取系统信息，先鸽了。</p>
<h2 id="8-13" id="8-13">8.13</h2>
<h3 id="zi-fu-chuan" id="字符串">字符串</h3>
<p>新的格式化字符串的语法：<code>f-string</code>。以<code>f</code>开头，表达式用<code>&#123;&#125;</code>包起来（似乎这样无法输出<code>&#123;,&#125;</code>字符）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>name = <span class="string">&#x27;Runoob&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;Hello <span class="subst">&#123;name&#125;</span>&#x27;</span>  <span class="comment"># 替换变量</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">f&#x27;<span class="subst">&#123;<span class="number">1</span>+<span class="number">2</span>&#125;</span>&#x27;</span>         <span class="comment"># 使用表达式</span></span><br><span class="line"><span class="string">&#x27;3&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在Python 3.8+可以使用<code>=</code>拼接表达式与结果：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;x+<span class="number">1</span>=&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="string">&#x27;x+1=2&#x27;</span></span><br></pre></td></tr></table></figure>
<h4 id="nei-jian-han-shu" id="内建函数">内建函数</h4>
<h5 id="count-str-beg-end" id="count-str-beg-end">.count(str,beg,end)</h5>
<p>返回出现次数，可以指定范围。</p>
<h5 id="find-str-beg-end" id="find-str-beg-end">.find(str,beg,end)</h5>
<p>查找子串，如果存在，返回开始的索引，否则返回-1.类似的有<code>rfind()</code>。</p>
<h5 id="join-seq" id="join-seq">.join(seq)</h5>
<p>以字符串为分隔符，合并seq中的元素为新串。</p>
<h5 id="replace" id="replace">.replace()</h5>
<h5 id="strip" id="strip">strip()</h5>
<p>删去前后空格。类似的还有<code>lstrip(),rstrip()</code>。</p>
<h5 id="split-str-num" id="split-str-num">.split(str,num)</h5>
<p>以str为分隔符截取字符串，如果num有指定值，则仅截取num+1个。</p>
<h5 id="splitlines" id="splitlines">.splitlines()</h5>
<h5 id="startwith" id="startwith">.startwith()</h5>
<h3 id="yun-suan-fu" id="运算符">运算符</h3>
<p><code>:=</code>：海象运算符，可以在表达式内部为变量赋值。</p>
<p><code>is,is not</code>：身份运算符，<code>x is y</code>等价于<code>id(x)==id(y)</code>（<code>id</code>用于取址）。</p>
<p><code>and</code>：从左到右计算表达式，若所有值为真，返回最后一个值，否则返回第一个假值。（<code>or</code>同理）</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/python3/python3-class.html">为class自定义运算符</a></p>
<p><img data-src="https://i.loli.net/2020/08/14/EWqJR2jgoLUs7kT.png" alt="image-20200814154005185"></p>
<h3 id="qi-ta" id="其他">其他</h3>
<p>Python整数对象的储存为无符号数加符号位。因此不存在补码。</p>
<p>Python的变量只要值相同，标识都相同。也就是说：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">5</span></span><br><span class="line">b = <span class="number">5</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(a) == <span class="built_in">id</span>(b)) <span class="comment"># True</span></span><br></pre></td></tr></table></figure>
<p>只要列表、字典内容一样，那么标识也一样。</p>
<p>元组的标识是跟着变量名的。</p>
<h2 id="8-14" id="8-14">8.14</h2>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/heapq.html#module-heapq">heapq</a> 提供了基于正规链表的堆实现。最小的值总是保持在 0 点。</p>
<p><code>heapify,heappop,heappush</code></p>
<p><code>calendar</code>标准库提供对日期、星期的计算支持。</p>
<h3 id="a-href-https-wiki-python-org-moin-python-speed-performance-tips-python-performance-tips-a" id="Python-Performance-Tips"><a target="_blank" rel="noopener" href="https://wiki.python.org/moin/PythonSpeed/PerformanceTips">Python Performance Tips</a></h3>
<p>对于字符串拼接，优先使用<code>''.join()</code>；避免过多的加法连接，使用<code>'&lt;html&gt;%s%s%s&lt;/html&gt;' % str</code>代替。</p>
<p>避免<code>.</code>，将频繁使用的推出函数用一个变量代替。</p>
<p><strong>有限使用局部变量，它们的访问速度很快</strong>。（因为Python会现在局部的<code>__dict__</code>中查询，再到全局中查询，而且miss的哈希表查询更加慢）</p>
<p>优先使用<code>map</code>，速度快。</p>
<p>对于大部分情况下为假的<code>if</code>语句：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># slow</span></span><br><span class="line">wdict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">    <span class="keyword">if</span> word <span class="keyword">not</span> <span class="keyword">in</span> wdict:</span><br><span class="line">        wdict[word] = <span class="number">0</span></span><br><span class="line">    wdict[word] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fast</span></span><br><span class="line">wdict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        wdict[word] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span> KeyError:</span><br><span class="line">        wdict[word] = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>另一种选择是使用<code>defaultdict</code>类。</p>
<p>Python函数调用的开销高。优先使用内置函数，因为内置函数是用C直接写的。</p>
<p>Python中加法比位运算快。（因为Python的int不定长，所以位运算比较鸡肋）</p>
<h2 id="8-16" id="8-16">8.16</h2>
<p>伪三目运算符：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;a&#x27;</span></span><br><span class="line">b = <span class="string">&#x27;b&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span> <span class="keyword">and</span> a <span class="keyword">or</span> b, <span class="number">0</span> <span class="keyword">and</span> a <span class="keyword">or</span> b)</span><br><span class="line"><span class="comment"># output: a b</span></span><br></pre></td></tr></table></figure>
<p>要求<code>a</code>不能为假（不为空）</p>
<p>安全使用的方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;&#x27;</span></span><br><span class="line">b = <span class="string">&#x27;b&#x27;</span></span><br><span class="line"><span class="built_in">print</span>((<span class="number">1</span> <span class="keyword">and</span> [a] <span class="keyword">or</span> [b])[<span class="number">0</span>], (<span class="number">0</span> <span class="keyword">and</span> [a] <span class="keyword">or</span> [b])[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># output:  b</span></span><br></pre></td></tr></table></figure>
<p>为什么要使用这么丑陋的语句？因为Python有时不能使用if语句，例如lambda函数中。</p>
<p>通过<code>compile,exec,eval</code>函数可以在运行时确定执行的代码。</p>
<p><code>os.system()</code>可以在<code>cmd</code>中执行命令。</p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Python/" rel="tag"><i class="fa fa-tag"></i> Python</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/Diary2021/" rel="prev" title="Diary2021">
      <i class="fa fa-chevron-left"></i> Diary2021
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/02/Python-webspider/" rel="next" title="Python学习笔记-爬虫探索">
      Python学习笔记-爬虫探索 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#2020-7-31"><span class="nav-number">1.</span> <span class="nav-text">2020.7.31</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rong-qi-chu-shi-hua"><span class="nav-number">1.1.</span> <span class="nav-text">容器初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#han-shu-can-shu"><span class="nav-number">1.2.</span> <span class="nav-text">函数参数</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#wei-zhi-can-shu"><span class="nav-number">1.2.1.</span> <span class="nav-text">位置参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ke-bian-can-shu"><span class="nav-number">1.2.2.</span> <span class="nav-text">可变参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#guan-jian-zi-can-shu"><span class="nav-number">1.2.3.</span> <span class="nav-text">关键字参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ming-ming-guan-jian-zi-can-shu"><span class="nav-number">1.2.4.</span> <span class="nav-text">命名关键字参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#can-shu-zu-he"><span class="nav-number">1.2.5.</span> <span class="nav-text">参数组合</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#qie-pian"><span class="nav-number">1.3.</span> <span class="nav-text">切片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#die-dai"><span class="nav-number">1.4.</span> <span class="nav-text">迭代</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lie-biao-sheng-cheng-shi"><span class="nav-number">1.5.</span> <span class="nav-text">列表生成式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#if-else-for"><span class="nav-number">1.5.1.</span> <span class="nav-text">if,else,for</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sheng-cheng-qi"><span class="nav-number">1.6.</span> <span class="nav-text">生成器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1"><span class="nav-number">2.</span> <span class="nav-text">8.1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#map-amp-reduce"><span class="nav-number">2.1.</span> <span class="nav-text">map&amp;reduce</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#filter"><span class="nav-number">2.2.</span> <span class="nav-text">filter</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sorted"><span class="nav-number">2.3.</span> <span class="nav-text">sorted</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bi-bao"><span class="nav-number">2.4.</span> <span class="nav-text">闭包</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#chuang-jian-ji-shu-qi"><span class="nav-number">2.4.1.</span> <span class="nav-text">创建计数器</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#global-amp-nonlocal"><span class="nav-number">2.5.</span> <span class="nav-text">global&amp;nonlocal</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ni-ming-han-shu"><span class="nav-number">2.6.</span> <span class="nav-text">匿名函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#zhuang-shi-qi"><span class="nav-number">2.7.</span> <span class="nav-text">装饰器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#pian-han-shu"><span class="nav-number">2.8.</span> <span class="nav-text">偏函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2"><span class="nav-number">3.</span> <span class="nav-text">8.2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mo-kuai"><span class="nav-number">3.1.</span> <span class="nav-text">模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#zuo-yong-yu"><span class="nav-number">3.1.1.</span> <span class="nav-text">作用域</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mian-xiang-dui-xiang-oop"><span class="nav-number">3.2.</span> <span class="nav-text">面向对象OOP</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ding-zhi-lei"><span class="nav-number">3.2.1.</span> <span class="nav-text">定制类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#type"><span class="nav-number">3.2.2.</span> <span class="nav-text">type</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#lei-he-shi-li"><span class="nav-number">3.3.</span> <span class="nav-text">类和实例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#qi-ta-fang-fa"><span class="nav-number">3.3.1.</span> <span class="nav-text">其他方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#gei-shi-li-bang-ding-yi-ge-fang-fa"><span class="nav-number">3.3.2.</span> <span class="nav-text">给实例绑定一个方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#property"><span class="nav-number">3.4.</span> <span class="nav-text">@property</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#duo-zhong-ji-cheng"><span class="nav-number">3.5.</span> <span class="nav-text">多重继承</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mei-ju-lei"><span class="nav-number">3.6.</span> <span class="nav-text">枚举类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#yuan-lei"><span class="nav-number">3.7.</span> <span class="nav-text">元类</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3"><span class="nav-number">4.</span> <span class="nav-text">8.3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cuo-wu-chu-li"><span class="nav-number">4.1.</span> <span class="nav-text">错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#diao-shi"><span class="nav-number">4.2.</span> <span class="nav-text">调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wen-jian-du-xie"><span class="nav-number">4.3.</span> <span class="nav-text">文件读写</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#string-io-amp-bytes-io"><span class="nav-number">4.3.1.</span> <span class="nav-text">StringIO&amp;BytesIO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#os-mo-kuai"><span class="nav-number">4.3.2.</span> <span class="nav-text">os模块</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#xu-lie-hua"><span class="nav-number">4.4.</span> <span class="nav-text">序列化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#chang-yong-nei-jian-mo-kuai"><span class="nav-number">4.5.</span> <span class="nav-text">常用内建模块</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#collections"><span class="nav-number">4.5.1.</span> <span class="nav-text">collections</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#hashlib"><span class="nav-number">4.5.2.</span> <span class="nav-text">hashlib</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#itertools"><span class="nav-number">4.5.3.</span> <span class="nav-text">itertools</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4"><span class="nav-number">5.</span> <span class="nav-text">8.4</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#json"><span class="nav-number">5.1.</span> <span class="nav-text">JSON</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#urllib"><span class="nav-number">5.2.</span> <span class="nav-text">urllib</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#get"><span class="nav-number">5.2.1.</span> <span class="nav-text">GET</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#post"><span class="nav-number">5.2.2.</span> <span class="nav-text">POST</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#handler"><span class="nav-number">5.2.3.</span> <span class="nav-text">Handler</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-10"><span class="nav-number">6.</span> <span class="nav-text">8.10</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pil"><span class="nav-number">6.1.</span> <span class="nav-text">PIL</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#sheng-cheng-yan-zheng-ma"><span class="nav-number">6.1.1.</span> <span class="nav-text">生成验证码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#requests"><span class="nav-number">6.2.</span> <span class="nav-text">requests</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#chardet"><span class="nav-number">6.3.</span> <span class="nav-text">chardet</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#psutil"><span class="nav-number">6.4.</span> <span class="nav-text">psutil</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-13"><span class="nav-number">7.</span> <span class="nav-text">8.13</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#zi-fu-chuan"><span class="nav-number">7.1.</span> <span class="nav-text">字符串</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#nei-jian-han-shu"><span class="nav-number">7.1.1.</span> <span class="nav-text">内建函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#count-str-beg-end"><span class="nav-number">7.1.1.1.</span> <span class="nav-text">.count(str,beg,end)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#find-str-beg-end"><span class="nav-number">7.1.1.2.</span> <span class="nav-text">.find(str,beg,end)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#join-seq"><span class="nav-number">7.1.1.3.</span> <span class="nav-text">.join(seq)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#replace"><span class="nav-number">7.1.1.4.</span> <span class="nav-text">.replace()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#strip"><span class="nav-number">7.1.1.5.</span> <span class="nav-text">strip()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#split-str-num"><span class="nav-number">7.1.1.6.</span> <span class="nav-text">.split(str,num)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#splitlines"><span class="nav-number">7.1.1.7.</span> <span class="nav-text">.splitlines()</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#startwith"><span class="nav-number">7.1.1.8.</span> <span class="nav-text">.startwith()</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#yun-suan-fu"><span class="nav-number">7.2.</span> <span class="nav-text">运算符</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#qi-ta"><span class="nav-number">7.3.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-14"><span class="nav-number">8.</span> <span class="nav-text">8.14</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#a-href-https-wiki-python-org-moin-python-speed-performance-tips-python-performance-tips-a"><span class="nav-number">8.1.</span> <span class="nav-text">Python Performance Tips</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-16"><span class="nav-number">9.</span> <span class="nav-text">8.16</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="i207M"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">i207M</p>
  <div class="site-description" itemprop="description">i207M's Fantastic Blog - Love</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">148</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/i207M" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;i207M" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:connect_at_mail.i207m.top" title="E-Mail → mailto:connect_at_mail.i207m.top" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-fw fa-fas fa-rss"></i></a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title">
      <i class="fa fa-fw fa-link"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://www.luogu.com.cn/blog/i207M/" title="https:&#x2F;&#x2F;www.luogu.com.cn&#x2F;blog&#x2F;i207M&#x2F;" rel="noopener" target="_blank">Luogu Blog</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://speranzaleaf.github.io/" title="https:&#x2F;&#x2F;speranzaleaf.github.io&#x2F;" rel="noopener" target="_blank">Speranza Leaf</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://kamome.moe/" title="https:&#x2F;&#x2F;kamome.moe&#x2F;" rel="noopener" target="_blank">Siunaus</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/cjyyb/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;cjyyb&#x2F;" rel="noopener" target="_blank">yyb</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://nekko.moe/" title="https:&#x2F;&#x2F;nekko.moe&#x2F;" rel="noopener" target="_blank">nekko</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/zjp-shadow/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;zjp-shadow&#x2F;" rel="noopener" target="_blank">zjp_shadow</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.ywy-c-asm.cn/" title="https:&#x2F;&#x2F;www.ywy-c-asm.cn&#x2F;" rel="noopener" target="_blank">ywy_c_asm</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/Miracevin/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;Miracevin&#x2F;" rel="noopener" target="_blank">Miracle</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://hahamengbier.top/" title="https:&#x2F;&#x2F;hahamengbier.top&#x2F;" rel="noopener" target="_blank">mengbier</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2020 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">i207M</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  




  
<script src="/js/local-search.js"></script>













    <div id="pjax">
  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '09f5f1273e68e2e773c5',
      clientSecret: 'b9b92a06fa16f2c2905b55b35c509e55c03fc596',
      repo        : 'blog-comment',
      owner       : 'i207M',
      admin       : ['i207M'],
      id          : '05a51648350c9bfc8b5635d98cf43b45',
      proxy       : 'https://cors.i207m.workers.dev/?https://github.com/login/oauth/access_token',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

    </div>
</body>
</html>
